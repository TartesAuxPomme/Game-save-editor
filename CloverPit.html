<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Clover Pit ‚Äî Save Editor</title>
<style>
:root {
  --green: #6af17f;
  --gold: #f5d36a;
  --bg1: #101a10;
  --bg2: #1c2a1c;
  --panel: #162416;
  --text: #d7f0d7;
  --muted: #9fb79f;
  font-family: 'Inter', system-ui, sans-serif;
}
html, body {
  margin: 0; height: 100%;
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  color: var(--text);
}
.container {
  max-width: 1000px;
  margin: 32px auto;
  background: linear-gradient(180deg, var(--panel), #111);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
}
h1 {
  color: var(--gold);
  margin-top: 0;
  font-size: 24px;
  text-shadow: 0 0 8px rgba(245, 211, 106, 0.4);
}
.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 14px;
}
input[type=file] {
  background: #111;
  border: 1px solid #333;
  padding: 8px;
  border-radius: 8px;
  color: var(--muted);
}
.btn {
  background: var(--gold);
  color: #000;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  font-weight: bold;
  cursor: pointer;
  transition: transform .15s, background .2s;
}
.btn:hover { transform: translateY(-2px); background: #ffe88c; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
textarea {
  width: 100%;
  height: 60vh;
  background: #0e160e;
  border: 1px solid #243424;
  border-radius: 8px;
  color: var(--text);
  padding: 10px;
  font-family: monospace;
  font-size: 14px;
  resize: none;
  outline: none;
}
.status {
  margin-top: 8px;
  font-size: 13px;
  color: var(--muted);
}
.footer {
  text-align: center;
  font-size: 12px;
  color: var(--muted);
  margin-top: 16px;
}
</style>
</head>
<body>
<div class="container">
  <h1>üçÄ Clover Pit ‚Äî Save Editor</h1>

  <div class="controls">
    <input id="fileInput" type="file" accept=".sav,.bin,.dat">
    <button id="loadBtn" class="btn">Charger</button>
    <button id="encryptBtn" class="btn" disabled>Recrypter & T√©l√©charger</button>
  </div>

  <textarea id="jsonArea" placeholder="Le contenu JSON d√©crypt√© s'affichera ici..."></textarea>
  <div id="status" class="status">Aucun fichier charg√©.</div>

  <div class="footer">Toujours faire une copie de sauvegarde avant modification ‚ö†Ô∏è</div>
</div>

<script>
const key = [0x48, 0x06, 0x5c, 0x11, 0x06, 0x43, 0x01, 0x60, 0x18, 0x55, 0x42, 0x18, 0x19, 0x1a, 0x00, 0x4a, 0x5a, 0x1a, 0x00, 0x51, 0x56, 0x46, 0x4e, 0x47, 0x0c, 0x1b, 0x01];
const fileInput = document.getElementById("fileInput");
const loadBtn = document.getElementById("loadBtn");
const encryptBtn = document.getElementById("encryptBtn");
const jsonArea = document.getElementById("jsonArea");
const statusEl = document.getElementById("status");
let decryptedText = "";
let originalBuffer = null;

function xorData(data, key) {
  const out = new Uint8Array(data.length);
  for (let i = 0; i < data.length; i++)
    out[i] = data[i] ^ key[i % key.length];
  return out;
}

loadBtn.onclick = () => {
  const file = fileInput.files[0];
  if (!file) return alert("Choisis un fichier de sauvegarde d'abord !");
  const reader = new FileReader();
  reader.onload = e => {
    originalBuffer = new Uint8Array(e.target.result);
    const decrypted = xorData(originalBuffer, key);
    try {
      decryptedText = new TextDecoder().decode(decrypted);
      const json = JSON.parse(decryptedText);
      jsonArea.value = JSON.stringify(json, null, 2);
      statusEl.textContent = "Fichier d√©crypt√© avec succ√®s ‚úÖ";
      encryptBtn.disabled = false;
    } catch {
      jsonArea.value = decryptedText;
      statusEl.textContent = "Fichier d√©crypt√©, mais pas un JSON valide ‚ö†Ô∏è";
      encryptBtn.disabled = false;
    }
  };
  reader.readAsArrayBuffer(file);
};

encryptBtn.onclick = () => {
  let newText = jsonArea.value;
  let jsonCheck;
  try {
    jsonCheck = JSON.parse(newText);
    newText = JSON.stringify(jsonCheck);
  } catch(e) {
    if (!confirm("Le texte n'est pas un JSON valide. Continuer quand m√™me ?")) return;
  }

  const bytes = new TextEncoder().encode(newText);
  const encrypted = xorData(bytes, key);
  const blob = new Blob([encrypted], {type: "application/octet-stream"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "modified_save.sav";
  a.click();
  statusEl.textContent = "Fichier recrytp√© et t√©l√©charg√© üíæ";
};
</script>
</body>
</html>
